- defaults:
    clean:
        force: true
    link:
        create: true
        force: true
        relink: true 
    shell:
        stderr: true
        stdout: true


- clean: ['~/']

- shell:
    - description: download vim pathogen
      command: >
          DOTVIMAUTODIR="${PWD}/vim/autoload/";
          SHASUMFILE="${PWD}/sha256.sums";
          cd /tmp &&
          curl -LSo "pathogen.vim" "https://tpo.pe/pathogen.vim" &&
          sha256sum --check --ignore-missing "$SHASUMFILE" && 
          mv "pathogen.vim" "$DOTVIMAUTODIR"

- link:
    ~/:
        path: home/.*
        glob: true
    ~/.vim: ~


- sudo:
    - link:
        # Link root config files to mine
        ~/:
            path: home/.*
            glob: true
        ~/.vim:
            path: vim


    - shell:
        - description: Update grub
          command: >
              DATESTAMP=$(date +%y%m%d%H%M);
              cp /etc/default/grub /etc/default/grub.$DATESTAMP.bak &&
              sed -i -E "
                  s/^GRUB_TIMEOUT_STYLE=.+/GRUB_TIMEOUT_STYLE=menu/;
                  s/^GRUB_TIMEOUT=.+/GRUB_TIMEOUT=5/;
                  s/^GRUB_CMDLINE_LINUX_DEFAULT.+/GRUB_CMDLINE_LINUX_DEFAULT=\"text\"/
              " /etc/default/grub && 
              update-grub


        - description: Disable CUPS
          command: >
              systemctl is-enabled cups &&
              (
                  systemctl disable --now cups &&
                  echo "cups disabled" &&
                  systemctl disable --now cups-browsed &&
                  echo "cups-browsed disabled"
              ) ||
              echo "cups not enabled... skipping."

